#!/bin/bash

if [ "$1" == "purge" ]; then
    if [ "`ps ax|grep cultipi|grep tclsh`" != "" ]; then
        for process in `ps ax|grep cultipi|grep tclsh|awk -F" " '{print $1}'`; do
            if [ "$process" != "" ]; then
                kill -9 $process
            fi
        done
    fi

    if [ -d /opt/cultipi ]; then
        rm -Rf /opt/cultipi
    fi

    if [ -d /etc/cultipi ]; then
        rm -Rf /etc/cultipi
    fi

    if [ -f /etc/init.d/cultipi ]; then
        update-rc.d -f cultipi remove
        rm -Rf /etc/init.d/cultipi
    fi

    if [ -d /var/log/cultipi ]; then
        rm -Rf /var/log/cultipi
    fi

    userdel cultipi
    sed -i "/cultipi ALL = (root) NOPASSWD: \/sbin\/modprobe/d" /etc/sudoers
    sed -i "/.*\/etc\/init.d\/cultipi.*/d" /etc/crontab
fi

if [ "$1" == "remove" ]; then
    if [ -f /etc/init.d/cultipi ]; then
        update-rc.d -f cultipi remove
        rm -Rf /etc/init.d/cultipi
    fi
    sed -i "/cultipi ALL = (root) NOPASSWD: \/sbin\/modprobe/d" /etc/sudoers
    sed -i "/.*\/etc\/init.d\/cultipi.*/d" /etc/crontab

    if [ -d /opt/cultipi ]; then
        rm -Rf /opt/cultipi
    fi
fi
