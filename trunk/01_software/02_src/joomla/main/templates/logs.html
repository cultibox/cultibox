<script type="text/javascript">
function verifDate(e) {
   if((e.keyCode < 45 || e.keyCode > 57)&&(e.keyCode != 08 && e.keyCode != 10 && e.keyCode != 13)) e.returnValue = false;
   if((e.which < 45 || e.which > 57)&&(e.which != 08 && e.which != 10 && e.which != 13)) return false;
}
</script>


<?php if((isset($pop_up))&&("$pop_up"!="False")&&(isset($pop_up_message))&&(!empty($pop_up_message))) { ?>
   <SCRIPT LANGUAGE="JavaScript">
      alert('<?php echo "$pop_up_message"; ?>');
   </SCRIPT>
<?php } else if((isset($pop_up))&&("$pop_up"!="False")&&(isset($pop_up_error_message))&&(!empty($pop_up_error_message))) { ?>
   <SCRIPT LANGUAGE="JavaScript">
      alert('<?php echo "$pop_up_error_message"; ?>');
   </SCRIPT>
<?php } ?>


<?php if((isset($info))&&(!empty($info))) { ?>
   <div id="info">
      <ul>
         <?php echo $info; ?>
      </ul>
   </div>
<?php } ?>

<?php if((isset($main_error))&&(!empty($main_error))) { ?>
<div id="error">
<ul>
        <?php echo $main_error; ?>
</ul>
</div>
<?php } ?>

<?php if((isset($error))&&(!empty($error))) { ?>
   <div id="error">
      <ul>
         <?php echo $error; ?>
      </ul>
   </div>
   <br />
<?php } ?>

<?php switch($lang) {

	case 'fr_FR': 
                echo '<script type="text/javascript" src="main/libs/js/jquery.ui.datepicker-fr.js"></script>'; 
		break;
        }
?>

<script>
$(function() {
   $("#datepicker").datepicker({ 
dateFormat: "yy-mm-dd",
showButtonPanel: true,
showOn: "both",
buttonImage: "../main/libs/img/datepicker.png",
buttonImageOnly: 'true',
<?php echo "buttonText: '".__('TIMEPICKER_BUTTON_TEXT_LOG')."',"; ?>
}).val()
});
</script>

<form action="<?php echo($_SERVER['PHP_SELF']); ?>" method="post">
<p class="title_conf"><img src="main/libs/img/arrow.png" /><?php echo __('SELECT_DISPLAYED_DAY'); ?></p>

<table width="100%">
   <tr>
      <td width="20%"></td>
      <td width="30%" align="left"><?php echo __('SELECT_DAY'); ?></td>
      <td width="50%" align="left"><input id="datepicker" name="startday" type="text" class="whitefield" size="10" value="<?php echo $startday; ?>"></td>
   </tr>
   <tr>
      <td></td>
      <td><?php echo __('SELECT_PROGRAM_PLUG'); ?></td>
      <td> <select name="select_plug">
            <option value="">---</option>
            <?php for($i=0;$i<$nb_plugs;$i++) { ?>
               <option value="<?php echo $plugs_infos[$i]["id"]; ?>" <?php if(strcmp($select_plug,$plugs_infos[$i]["id"])==0) echo "selected"; ?>><?php echo $plugs_infos[$i]["PLUG_NAME"]; ?></option>
            <?php } ?>
         </select>
      </td>
   </tr>
   <tr>
      <td></td>
      <td><?php echo __('SELECT_POWER_PLUG'); ?></td>
      <td><input type="checkbox" name="show_power"></td>
   </tr>
   <tr>
   <td></td>
   <td>
         <p align="right"><INPUT type="submit" value=<?php echo __('VIEW'); ?> onKeypress="return verifDigit(event);"></p>
   </td>
   <td></td>
</tr>
</table>
</form>
<hr />
<form action=<?php echo($_SERVER['PHP_SELF']); ?> method="post">
<table width="100%">
   <tr>
      <td width="40%"><p class="title_conf"><img src="main/libs/img/arrow.png" /><?php echo __('SELECT_DISPLAYED_MONTH'); ?></p></td>
      <td width="20%" align="left">
            <select name="startmonth">
               <option <?php if("$startmonth" == "1") { echo 'selected';} ?> value="01"><?php echo __('MONTH01'); ?></option>
               <option <?php if("$startmonth" == "2") { echo 'selected';} ?> value="02"><?php echo __('MONTH02'); ?></option>
               <option <?php if("$startmonth" == "3") { echo 'selected';} ?> value="03"><?php echo __('MONTH03'); ?></option>
               <option <?php if("$startmonth" == "4") { echo 'selected';} ?> value="04"><?php echo __('MONTH04'); ?></option>
               <option <?php if("$startmonth" == "5") { echo 'selected';} ?> value="05"><?php echo __('MONTH05'); ?></option>
               <option <?php if("$startmonth" == "6") { echo 'selected';} ?> value="06"><?php echo __('MONTH06'); ?></option>
               <option <?php if("$startmonth" == "7") { echo 'selected';} ?> value="07"><?php echo __('MONTH07'); ?></option>
               <option <?php if("$startmonth" == "8") { echo 'selected';} ?> value="08"><?php echo __('MONTH08'); ?></option>
               <option <?php if("$startmonth" == "9") { echo 'selected';} ?> value="09"><?php echo __('MONTH09'); ?></option>
               <option <?php if("$startmonth" == "10") { echo 'selected';} ?> value="10"><?php echo __('MONTH10'); ?></option>
               <option <?php if("$startmonth" == "11") { echo 'selected';} ?> value="11"><?php echo __('MONTH11'); ?></option>
               <option <?php if("$startmonth" == "12") { echo 'selected';} ?> value="12"><?php echo __('MONTH12'); ?></option>
            </select>
            <?php if($GLOBALS['FIRST_LOG_YEAR']==$last_year) {
                  echo '<input type="text" name="startyear" value="'.$last_year.'" size="4" disabled="disabled"';
            }

            if($GLOBALS['FIRST_LOG_YEAR']!=$last_year) {
                 echo '<select name="startyear">';
                 $first=$GLOBALS['FIRST_LOG_YEAR'];
                 for($i=$first;$i<=$last_year;$i++) { ?>
                     <option <?php if("$startyear" == "$i") { echo 'selected';} ?> value="<?php echo $i; ?>"><?php echo $i; ?></option>
                  <?php }
                  echo "</select>";
            } ?>
      </td>
      <td width="40%"></td>
   </tr>
   <tr>
      <td></td>
      <td><p align="center"><INPUT type="submit" value=<?php echo __('VIEW'); ?>></p></td>
      <td></td>
   </tr>
</table>
</form>
<hr />


<?php if($check_format) { ?>
<script type="text/javascript">

Highcharts.setOptions({
lang: {
<?php echo "resetZoom : '".__('RESET_ZOOM')."',"; ?>
<?php echo "resetZoomTitle : '".__('RESET_ZOOM_TITLE')."'"; ?>
}
});

$(function () {
   var chart;
   $(document).ready(function() {
      chart = new Highcharts.Chart({
         chart: {
            backgroundColor: '#F7F7F9',
             renderTo: 'container',
             zoomType: 'x',
             spacingRight: 20,
             events: {
                load: function() {
                   <?php if($fake_log) echo "this.renderer.image('http://localhost:".$GLOBALS['SOFT_PORT']."/joomla/main/libs/img/fake_log_".__('LANG').".png', 80, 55, 143, 57)"; ?>
                   <?php if($fake_log)  echo ".add();"; ?>
                }
             }
         },
         title: {
             text: <?php echo "'".__('HISTO_GRAPH')." (".$legend_date.")'"; ?>,
         },
         subtitle: {
             text: document.ontouchstart === undefined ?
               <?php echo "'".__('DRAG_PLOT')."'"; ?>:
               <?php echo "'".__('DRAG_PLOT')."'"; ?>
         },
         lang: {
            printButtonTitle: <?php echo "'".__('PRINT_HIGHCHART')."',"; ?>
            exportButtonTitle: <?php echo "'".__('EXPORT_HIGHCHART')."',"; ?>
            downloadPNG : <?php echo "'".__('EXPORT_PNG')."',"; ?>
            downloadJPEG : <?php echo "'".__('EXPORT_JPEG')."',"; ?>
            downloadPDF : <?php echo "'".__('EXPORT_PDF')."',"; ?>
            downloadSVG : <?php echo "'".__('EXPORT_SVG')."',"; ?>
            resetZoom : <?php echo "'".__('RESET_ZOOM')."',"; ?>
            resetZoomTitle : <?php echo "'".__('RESET_ZOOM_TITLE')."'"; ?>
         },
         xAxis: {
            type: 'datetime',
            <?php if("$type"=="month") { echo "tickInterval: 5 * 24 * 3600 * 1000,"; } ?>
            title: {
               text: <?php echo "'".__("$xlegend")."'"; ?>
            }
         },
         yAxis: [
            {
               title: {
                  text: <?php echo "'".__('YAXIS_LEGEND')."'"; ?>,
                  style: {
                     color: <?php echo "'".$color_humidity."'"; ?>
                  }
               },
               min: -0.5,
               max: <?php echo "$hygro_axis"; ?>,
               startOnTick: false,
               showFirstLabel: false,
               labels: {
                  formatter: function() {
                     if(this.value<=100) return this.value;
                  }
               }
            }, {
               title: {
                  text: <?php echo "'".__('Y2AXIS_LEGEND')."'"; ?>,
                  style: {
                     color: <?php echo "'".$color_temperature."'"; ?>
                  }
               },
               min: 0,
               max: <?php echo "$temp_axis"; ?>,
               startOnTick: false,
               showFirstLabel: false,
               opposite: true,
               labels: {
                  formatter: function() {
                     if(this.value<=100) return this.value;
                  }
               }
            }
         ],
         tooltip: {
            shared: true,
            formatter: function() {
               var tab=new Array;
               <?php if((isset($data_humi))&&(!empty($data_humi))) { ?>
                  j = tab.length;   
                  tab[j]="%";
               <?php } ?>
   
               <?php if((isset($data_temp))&&(!empty($data_temp))) { ?>
                  j = tab.length;   
                  tab[j]="°C";
                                   <?php } ?>
   
               <?php if((isset($plug_type))&&(!empty($plug_type))) { ?>
                  <?php if((strcmp($plug_type,"ventilator")==0)||(strcmp($plug_type,"heating")==0)) { ?>
                     j = tab.length; 
                     tab[j]="°C";
                  <?php } else if((strcmp($plug_type,"humidifier")==0)||(strcmp($plug_type,"dehumidifier")==0)) { ?>
                     j = tab.length; 
                     tab[j]="°C";
                  <?php } else { ?>
                     j = tab.length; 
                     tab[j]="";
                  <?php } ?>
               <?php } ?>
   
               <?php if("$type"=="month") { ?>
                  var val="<p align='left'><b><?php echo __('XAXIS_LEGEND_DAY'); ?>:  "+Highcharts.dateFormat('%H:%M:%S %Y/%m/%d', this.x)+"</b></p>";
               <?php } else { ?>
                  var val="<p align='left'><b><?php echo __('XAXIS_LEGEND_DAY'); ?>:  "+Highcharts.dateFormat('%H:%M:%S', this.x)+"</b></p>"; 
               <?php } ?>
               for(var i= 0; i < this.points.length; i++) {
                  if(tab[i]!="") {
                     if(this.points[i].y==99.9) {
                        val=val+'<br /><p align="left" style="color:'+this.points[i].series.color+';">'+this.points[i].series.name+': <?php echo __("FORCE_ON_CHART"); ?></p>';
                     } else if(this.points[i].y==0) {
                        val=val+'<br /><p align="left" style="color:'+this.points[i].series.color+';">'+this.points[i].series.name+': <?php echo __("VALUE_OFF"); ?></p>';
                     } else {
                        val=val+'<br /><p align="left" style="color:'+this.points[i].series.color+';">'+this.points[i].series.name+': '+this.points[i].y+tab[i]+'</p>';
                     }
                  } else {
                     if(this.points[i].y==99.9) {
                        val=val+'<br /><p align="left" style="color:'+this.points[i].series.color+';">'+this.points[i].series.name+': <?php echo __("VALUE_ON"); ?></p>';
                     } else {
                        val=val+'<br /><p align="left" style="color:'+this.points[i].series.color+';">'+this.points[i].series.name+': <?php echo __("VALUE_OFF"); ?></p>';
                     }
                  }
               }
               return val;
            }
         },
         legend: {
            enabled: true
         },
         credits: {
            enabled: false
         },
         plotOptions: {
            area: {
               fillColor: {
                  linearGradient: { x1: 3, y1: 0, x2: 0, y2: 1}, 
                  stops: [
                      [0, Highcharts.getOptions().colors[0]],
                      [1, 'rgba(2,0,0,0)']
                  ]
               
               },
               lineWidth: 1,
               marker: {
                  enabled: false,
                  states: {
                      hover: {
                          enabled: true,
                          radius: 5
                      }
                  }
               },
               shadow: false,
               states: {
                  hover: {
                      lineWidth: 1
                  }
               }
            }
         },

         series: [
            {
               type: 'area',
               name: <?php echo "'".__('LEGEND_HUMI')."'"; ?>,
               pointInterval:  <?php echo "$next"; ?> * 60 * 1000,
               pointStart: Date.UTC(<?php echo $styear.",".$stmonth.",".$stday; ?>),
               color: <?php echo "'".$color_humidity."'"; ?>,
               data: [
                  <?php if((isset($data_humi))&&(!empty($data_humi))) echo "$data_humi"; ?>
               ]
            }, {
               type: 'area',
               name: <?php echo "'".__('LEGEND_TEMP')."'"; ?>,
               pointInterval: <?php echo "$next"; ?> * 60 * 1000,
               pointStart: Date.UTC(<?php echo $styear.",".$stmonth.",".$stday; ?>),
               color: <?php echo "'".$color_temperature."'"; ?>,
               yAxis: 1,
               data: [
                  <?php if((isset($data_temp))&&(!empty($data_temp))) echo "$data_temp"; ?>
               ]
               <?php if((isset($data))&&(!empty($data))) { ?>
               }, {
                  name: <?php echo "'".$plugs_infos[$select_plug-1]["PLUG_NAME"]."'"; ?>,
                  color: <?php echo "'".$GLOBALS["LIST_GRAPHIC_COLOR_PROGRAM"][$select_plug-1]."'"; ?>,
                  data: [
                    <?php if((isset($data))&&(!empty($data))) echo "$data"; ?>
                  ]
               <?php } ?>
            }
         ]
        });
    });
    
});
</script>
<br /><br />
<div id="container" style="width: 800px; height: 400px; margin: 0 auto"></div>

<?php } ?>
<br />
