<?php if((isset($pop_up))&&("$pop_up"!="False")&&(isset($pop_up_message))&&(!empty($pop_up_message))) { ?>
    <div class="pop_up_message" style="display:none">
            <?php echo str_replace("\\n\\n","<br /><br />","$pop_up_message"); ?>
    </div>
<?php } else if((isset($pop_up))&&("$pop_up"!="False")&&(isset($pop_up_error_message))&&(!empty($pop_up_error_message))) { ?>
       <div class="pop_up_error" style="display:none">
            <?php echo str_replace("\\n\\n","<br /><br />","$pop_up_error_message"); ?>
       </div>
<?php } ?>


<?php if((((isset($main_info))&&(!empty($main_info))&&(count($main_info)>0)))||((isset($main_error))&&(count($main_error)>0))) { ?>
<div class="message" style="display:none" title="<?php echo __('MESSAGE_BOX'); ?>">
        <br />
        <?php if((isset($main_info))&&(!empty($main_info))&&(count($main_info)>0)) { ?>
<img src="main/libs/img/informations.png" alt="" /><label class="info_title"><?php echo __('INFORMATION'); ?>:</label>
<div class="info">
<ul>
        <?php foreach($main_info as $inf) { 
            echo "<li>".$inf."</li>";            
        } ?>
</ul>
<br />
</div>
    <?php } ?>
    <?php if((isset($main_error))&&(count($main_error)>0)) { ?>
<img src="main/libs/img/warning.png" alt="" /><label class="error_title"><?php echo __('WARNING'); ?>:</label>
<div class="error">
<ul>
        <?php foreach($main_error as $err) { 
            echo "<li>".$err."</li>";            
        } ?>
</ul>
</div>
    <?php } ?>
</div>
<?php } ?>
<br />


<?php switch($_SESSION['LANG']) {
	    case 'fr_FR': 
                echo '<script type="text/javascript" src="main/libs/js/jquery.ui.datepicker-fr.js"></script>'; 
		        break;
        case 'it_IT':
                echo '<script type="text/javascript" src="main/libs/js/jquery.ui.datepicker-it.js"></script>';
                break;
        case 'de_DE':
                echo '<script type="text/javascript" src="main/libs/js/jquery.ui.datepicker-de.js"></script>';
                break;
        case 'es_ES':
                echo '<script type="text/javascript" src="main/libs/js/jquery.ui.datepicker-es.js"></script>';
                break;
        }
?>

<?php if((isset($anchor))&&(!empty($anchor))) { ?>
    <script>
        $(document).ready(function(){
           $.scrollTo('#<?php echo $anchor; ?>',300); 
        });
    </script>
<?php } ?>



<script>
title_msgbox=<?php echo json_encode(__('TOOLTIP_MSGBOX_EYES')); ?>;

$(function() {
   $("#datepicker").datepicker({ 
dateFormat: "yy-mm-dd",
showButtonPanel: true,
showOn: "both",
buttonImage: "../../main/libs/img/datepicker.png",
buttonImageOnly: 'true',
<?php echo "buttonText: '".__('TIMEPICKER_BUTTON_TEXT_LOG')."',"; ?>
}).val()


 $("#datepicker_from").datepicker({ 
dateFormat: "yy-mm-dd",
showButtonPanel: true,
showOn: "both",
buttonImage: "../../main/libs/img/datepicker.png",
buttonImageOnly: 'true',
<?php echo "buttonText: '".__('TIMEPICKER_BUTTON_TEXT_LOG')."',"; ?>
}).val()


 $("#datepicker_to").datepicker({ 
dateFormat: "yy-mm-dd",
showButtonPanel: true,
showOn: "both",
buttonImage: "../../main/libs/img/datepicker.png",
buttonImageOnly: 'true',
<?php echo "buttonText: '".__('TIMEPICKER_BUTTON_TEXT_LOG')."',"; ?>
}).val()


 $("#datepicker_from_power").datepicker({ 
dateFormat: "yy-mm-dd",
showButtonPanel: true,
showOn: "both",
buttonImage: "../../main/libs/img/datepicker.png",
buttonImageOnly: 'true',
<?php echo "buttonText: '".__('TIMEPICKER_BUTTON_TEXT_LOG')."',"; ?>
}).val()


 $("#datepicker_to_power").datepicker({ 
dateFormat: "yy-mm-dd",
showButtonPanel: true,
showOn: "both",
buttonImage: "../../main/libs/img/datepicker.png",
buttonImageOnly: 'true',
<?php echo "buttonText: '".__('TIMEPICKER_BUTTON_TEXT_LOG')."',"; ?>
}).val()


});
</script>


<label class="title_conf"><?php echo __('SELECT_LOG_TITLE'); ?></label>
<br />
<div id="label_select_type">
<form>
<table class="table_width">
    <tr>
        <td class="log-marge-day-main"></td>
        <td class="log-marge-day-title-select"><b><?php echo __('SELECT_DISPLAYED_DAY'); ?>:</b></td>
        <td class="log-marge-day-field-select"><input type= "radio" id="select_day" name="type_select" value="day" <?php if(strcmp($type,"days")==0) echo "checked"; ?> onChange="getType(0);" onLoad="getType(0);" ><?php echo __('ONE_DAY'); ?><input type= "radio" id="select_month" name="type_select" value="month" <?php if(strcmp($type,"month")==0) echo "checked"; ?> onChange="getType(1);" onLoad="getType(1);" ><?php echo __('ONE_MONTH'); ?>
        </td>
        <td></td>
    </tr>
</table>   
</form>
</div>
<br />
<div id="label_select_day" class="div_height" style="<?php if(strcmp($type,"days")!=0) echo "display:none"; ?>">
<form name="display-log-day" id="display-log-day" action="display-logs-<?php echo $_SESSION['SHORTLANG']; ?>" method="post">
<table class="table_width">
   <tr>
      <td class="log-marge-day"></td>
      <td class="log-marge-day-title"><?php echo __('SELECT_DAY'); ?>:</td>
      <td class="log-marge-day-field"><input id="datepicker" name="startday" type="text" class="whitefield" size="10" value="<?php echo $startday; ?>"></td>
      <td><div id="error_start_days" style="display:none" class="error_field"><img src='/cultibox/main/libs/img/arrow_error.png' alt=''><?php echo __('ERROR_FORMAT_DATE_DAY'); ?></div></td>
   </tr>
   <tr>
      <td></td>
      <td><?php echo __('SELECT_PROGRAM_PLUG'); ?><img src="main/libs/img/infos.png" alt="" title="<?php echo __('TOOLTIP_LOG_PROGRAM'); ?>" />:</td>
      <td> <select name="select_plug">
            <option value="">---</option>
            <?php foreach($active_plugs as $plugs) {  ; ?>
               <option value="<?php echo $plugs['id']; ?>" <?php if(strcmp($select_plug,$plugs['id'])==0) echo "selected"; ?>><?php echo $plugs_infos[$plugs['id']-1]["PLUG_NAME"]; ?></option>
            <?php } ?>
         </select>
      </td>
      <td></td>
   </tr>
    <tr>
      <td></td>
      <td><?php echo __('SELECT_SENSOR_NB'); ?>:</td>
      <td>
      <br />
          <table>
           <tr>
             <?php for($i=1;$i<=$GLOBALS['NB_MAX_SENSOR_LOG'];$i++) { ?>
                <td class="sensor_max"><?php echo __('SENSOR')." ".$i; ?></td><td><input type="checkbox" name="select_sensor[]" value="<?php echo  $i; ?>" <?php if(in_array($i,$select_sensor)) { echo ' checked'; } ?>> </td>
                <?php if($i % 2 == 0) { ?></tr><tr><?php } ?>
            <?php } ?>
                </tr>
            </table>
        </td>
      <td></td>
    </tr>
    <tr>
      <td></td>
      <td><?php echo __('SELECT_POWER_PLUG'); ?><img src="main/libs/img/infos.png" alt="" title="<?php echo __('TOOLTIP_POWER_LOG'); ?>" />:</td>
      <td>
            <br />
            <table>
            <tr>
            <?php for($plugs=1;$plugs<=$nb_plugs;$plugs++) {  ?>
                <td class="power_max"><?php echo $plugs_infos[$plugs-1]["PLUG_NAME"]; ?></td><td><input type="checkbox" name="select_power[]" value="<?php echo  $plugs; ?>" <?php if(in_array($plugs,$select_power)) { echo ' checked'; } ?>> </td>
                <?php if($plugs % 2 == 0) { ?></tr><tr><?php } ?>
            <?php } ?>
                </tr>
            </table>
            <br />
      </td>
     <td></td>
   </tr>
</table>

<table class="table_width">
<tr>
    <td></td>
    <td class="program-valid-right"><input type="submit" value=<?php echo __('VIEW'); ?> name="display-log-submit" id="display-log-submit"  onKeypress="return verifDigit(event);"></td>
    <td></td>
</tr>
</table>
    <input type="hidden" name="import_load" id="import_load" value="<?php echo $import_load; ?>">
    <input type="hidden" name="anchor" value="anchor-logs">
</form>
<br />
</div>
<div id="label_select_month" class="div_height" style="<?php if(strcmp($type,"days")==0) echo "display:none"; ?>">
<form name="display-log-month" id="display-log-month" action="/cultibox/index.php/waiting-data" method="post">
<table class="table_width">
   <tr>
      <td class="log-marge-month"></td>
      <td class="log-marge-month-title"><?php echo __('MONTH_DATE'); ?>:</td>
      <td class="log-marge-month-field">
            <select name="startmonth" id="startmonth">
               <option <?php if("$startmonth" == "1") { echo 'selected';} ?> value="01"><?php echo __('MONTH01'); ?></option>
               <option <?php if("$startmonth" == "2") { echo 'selected';} ?> value="02"><?php echo __('MONTH02'); ?></option>
               <option <?php if("$startmonth" == "3") { echo 'selected';} ?> value="03"><?php echo __('MONTH03'); ?></option>
               <option <?php if("$startmonth" == "4") { echo 'selected';} ?> value="04"><?php echo __('MONTH04'); ?></option>
               <option <?php if("$startmonth" == "5") { echo 'selected';} ?> value="05"><?php echo __('MONTH05'); ?></option>
               <option <?php if("$startmonth" == "6") { echo 'selected';} ?> value="06"><?php echo __('MONTH06'); ?></option>
               <option <?php if("$startmonth" == "7") { echo 'selected';} ?> value="07"><?php echo __('MONTH07'); ?></option>
               <option <?php if("$startmonth" == "8") { echo 'selected';} ?> value="08"><?php echo __('MONTH08'); ?></option>
               <option <?php if("$startmonth" == "9") { echo 'selected';} ?> value="09"><?php echo __('MONTH09'); ?></option>
               <option <?php if("$startmonth" == "10") { echo 'selected';} ?> value="10"><?php echo __('MONTH10'); ?></option>
               <option <?php if("$startmonth" == "11") { echo 'selected';} ?> value="11"><?php echo __('MONTH11'); ?></option>
               <option <?php if("$startmonth" == "12") { echo 'selected';} ?> value="12"><?php echo __('MONTH12'); ?></option>
            </select>

            <?php 
                 echo '<select name="startyear" id="startyear">';
                 $first=$GLOBALS['FIRST_LOG_YEAR'];
                 for($i=$first;$i<=$last_year;$i++) { ?>
                     <option <?php if("$startyear" == "$i") { echo 'selected';} ?> value="<?php echo $i; ?>"><?php echo $i; ?></option>
                  <?php }
                  echo "</select>";
            ?>
      </td>
	  <td><div id="error_start_month" class="error_field" style="display:none"><img src='/cultibox/main/libs/img/arrow_error.png' alt=''><?php echo __('ERROR_FORMAT_DATE_MONTH'); ?></div></td> 
   </tr>
   <tr>
      <td></td>
      <td><?php echo __('SELECT_SENSOR_NB'); ?>:</td>
      <td> <select name="select_sensor">
            <?php for($i=1;$i<=$GLOBALS['NB_MAX_SENSOR_LOG'];$i++) { ?>
               <option value="<?php echo $i; ?>" <?php if(strcmp($select_sensor[0],$i)==0) echo "selected"; ?>><?php echo __('SELECT_SENSOR')." ".$i; ?></option>
            <?php } ?>
         </select>
      </td>
      <td></td>
   </tr>
</table>

<table class="table_width">
<tr>
    <td></td>
    <td class="program-valid-right"><br /><input type="submit" value=<?php echo __('VIEW'); ?>></td>
    <td></td>
</tr>
</table>
</form>
<br />
</div>
<br />
<hr />
<script type="text/javascript">
var extremes_save = null;

Highcharts.setOptions({
lang: {
<?php echo "resetZoom : '".__('RESET_ZOOM_TITLE','highchart')."',"; ?>
<?php echo "resetZoomTitle : '".__('RESET_ZOOM_TITLE','highchart')."'"; ?>
}
});

var showzoomX = false;

$(function () {
   var chart;
   $(document).ready(function() {
      chart = new Highcharts.Chart({
         chart: {
            backgroundColor: '#F7F7F9',
            borderWidth: 3,
            borderColor: '#959891',
            borderRadius: 20,
            renderTo: 'container',
            zoomType: 'xy',
            alignTicks: false,
            spacingRight: 20,
            resetZoomButton: {
                theme: {
                 display: 'none'
                }
            },
            events: {
               load: function() {
                  <?php if($fake_log) echo "this.renderer.image('http://localhost:".$GLOBALS['SOFT_PORT']."/cultibox/main/libs/img/fake_log_".__('LANG').".png', 600, 15, 130, 50)"; ?>
                  <?php if($fake_log)  echo ".add();"; ?>
               }
            }
         },
         title: {
             margin: 35,
    	     useHTML: true,
             text: <?php echo "'<b>".__('HISTO_GRAPH')." (".$legend_date.")*</b>'"; ?>,
         },
         subtitle: {
	     useHTML: true,
             text: document.ontouchstart === undefined ?
               <?php echo "'".__('DRAG_PLOT')."'"; ?>:
               <?php echo "'".__('DRAG_PLOT')."'"; ?>
         },
         lang: {
	    useHTML: true,
            printChart: <?php echo "'".__('PRINT_HIGHCHART')."',"; ?>
            exportButtonTitle: <?php echo "'".__('EXPORT_HIGHCHART')."',"; ?>
            downloadPNG : <?php echo "'".__('EXPORT_PNG')."',"; ?>
            downloadJPEG : <?php echo "'".__('EXPORT_JPEG')."',"; ?>
            downloadPDF : <?php echo "'".__('EXPORT_PDF')."',"; ?>
            downloadSVG : <?php echo "'".__('EXPORT_SVG')."',"; ?>
            resetZoom : <?php echo "'".__('RESET_ZOOM_TITLE')."',"; ?>
            resetZoomTitle : <?php echo "'".__('RESET_ZOOM_TITLE')."'"; ?>,
            contextButtonTitle: <?php echo "'".__('CONTEXT_MENU')."'"; ?>
         },
        scrollbar: {
            enabled: true
        },
        
        rangeSelector: {
            selected: 1
        },
         xAxis: {
            type: 'datetime',
            endOnTick: false,
            showFirstLabel: true,
            <?php if("$type"=="month") { echo "tickInterval: 5 * 24 * 3600 * 1000,"; } ?>
            title: {
	       useHTML: true,
               text: <?php echo "'".__("$xlegend")."'"; ?>
            },
            events: {
                afterSetExtremes: function(event){
                    $('#resetXzoom').show();
                    showzoomX=true;
                }
            }
         },
         yAxis: [
            <?php $count=1; ?>
            <?php foreach($data_log as $datalog) { ?>
            <?php if($count>1) echo ","; ?>
            {
               title: {
		          useHTML: true,
                  text: <?php echo "'".clean_highchart_message($datalog['yaxis1_legend'])."'"; ?>,
                  style: {
                     color: <?php echo "'".$datalog['color_record1']."'"; ?>
                  }
               },
               startOnTick: false,
               endOnTick: false, 
               allowDecimals: true,
               <?php if($count%2==0) { ?>
                    opposite: true,
               <?php } ?>
               events: {
                afterSetExtremes: function() {
                    if (this.min <= this.dataMin && this.max >= this.dataMax) {
                        if(chart.resetZoomButton) {
                            chart.resetZoomButton.hide();
                        }
                    }
                }
               },
               labels: {
                  style: {
                    color: <?php echo "'".$datalog['color_record1']."'"; ?>
                  },
                  formatter: function() {
                     return this.value;
                  }
               },
               gridLineWidth: 1,
               gridLineDashStyle: 'Dot',
               gridLineColor : <?php echo "'".$datalog['color_grid1']."'"; ?>
              }
              <?php if($datalog['sensor_type']==2) { 
                    $count=$count+1;

              ?>
              ,{
                title: {
                  useHTML: true,
                  text: <?php echo "'".clean_highchart_message($datalog['yaxis2_legend'])."'"; ?>,
                  style: {
                     color: <?php echo "'".$datalog['color_record2']."'"; ?>
                  }
               },
               startOnTick: false,
               endOnTick: false, 
               allowDecimals: true,
               <?php if($count%2==0) { ?>
                    opposite: true,
               <?php } ?>
               events: {
                afterSetExtremes: function() {
                    if (this.min <= this.dataMin && this.max >= this.dataMax) {
                        if(chart.resetZoomButton) {
                            chart.resetZoomButton.hide();
                        }
                    }
                }
               },
               labels: {
                  style: {
                    color: <?php echo "'".$datalog['color_record2']."'"; ?>
                  },
                  formatter: function() {
                     return this.value;
                  }
               },
               gridLineWidth: 1,
               gridLineDashStyle: 'Dot',
               gridLineColor : <?php echo "'".$datalog['color_grid2']."'"; ?>
               }
            <?php  
                } 
                $count=$count+1; 
            } ?>
         ],
         tooltip: {
            useHTML: true,
            formatter: function() {
               var tab=new Array;
               <?php if("$type"=="month") { ?>
                  var val="<p align='left'><b><?php echo __('XAXIS_LEGEND_DAY'); ?>:  </b>"+Highcharts.dateFormat('%H:%M:%S %Y/%m/%d', this.x)+"</p>";
               <?php } else { ?>
                  var val="<p align='left'><b><?php echo __('XAXIS_LEGEND_DAY'); ?>:  </b>"+Highcharts.dateFormat('%H:%M:%S', this.x)+"</p>"; 
               <?php } ?>
                  var unit = {
                     <?php for($i=1;$i<=$GLOBALS['NB_MAX_SENSOR_LOG'];$i++) { 
                     echo "'".__('HUMI_LEGEND')." (".__('SENSOR')." ".$i.")': '%',";
                     echo "'".__('TEMP_LEGEND')." (".__('SENSOR')." ".$i.")': '°C',";
               } ?>
               <?php echo "'".__('HUMI_LEGEND')." (".__('EXAMPLE_LOG').")': '%',"; ?>
               <?php echo "'".__('TEMP_LEGEND')." (".__('EXAMPLE_LOG').")': '%',"; ?>
               <?php echo "'".__('POWER_LEGEND')."'"; ?>: 'W'
               <?php if((isset($select_plug))&&(!empty($select_plug))) {
                     echo ",'".clean_highchart_message($plugs_infos[$select_plug-1]["PLUG_NAME"])."': ''"; 
               } ?>
            }[this.series.name];
            if(unit=='') { 
               if(this.y==100) {
                     behaviour='<?php echo __("VALUE_ON"); ?>';
                     nounity=true; 
               } else if(this.y==0){
                     behaviour='<?php echo __("VALUE_OFF"); ?>';
                     nounity=true;
               } else {
                     behaviour=(this.y)*100/100;
                     behaviour=behaviour.toFixed(1);
               }
                  <?php
                   $unity="";
                   if((isset($select_plug))&&(!empty($select_plug))) {
                        switch($plugs_infos[$select_plug-1]["PLUG_TYPE"]) {
                            case 'lamp': $unity="";
                                 break;
                            case 'other': $unity="";
                                break;
                            case 'ventilator': $unity="°C";
                                break;
                            case 'heating': $unity="°C";
                                break;
                            case 'pump': $unity="cm";
                                break;
                            case 'humidifier': $unity="%";
                                break;
                            case 'dehumidifier': $unity="%";
                                break;
                        } 
               } ?>
               if(!nounity) {
                var unit="<?php echo $unity; ?>";
               } else {
                    var unit="";
               }
               return val+"<p align='left'><b>"+this.series.name+":</b> "+behaviour+unit+"</p>";
            } else {
               return val+"<p align='left'><b>"+this.series.name+":</b> "+this.y+unit+"</p>";
            }
          }
         },
        legend: {
        width: 450,
        itemWidth: 225,
	    useHTML: true,
            layout: 'horizontal',
            verticalAlign: 'bottom',
            navigation: {
                activeColor: '#3E576F',
                animation: true,
                arrowSize: 12,
                inactiveColor: '#CCC',
                style: {
                    fontWeight: 'bold',
                    color: '#333',
                    fontSize: '12px'    
                }
            }
         },
         credits: {
            enabled: false
         },
         plotOptions: {
            series: {
                events: {
                    legendItemClick: function () {
                        return false;
                    }
                }
            },
            area: {
               fillColor: {
                  linearGradient: { x1: 3, y1: 0, x2: 0, y2: 1}, 
                  stops: [
                      [0, Highcharts.getOptions().colors[0]],
                      [1, 'rgba(2,0,0,0)']
                  ]
               
               },
               lineWidth: 1,
               marker: {
                  enabled: false,
                  states: {
                      hover: {
                          enabled: true,
                          radius: 5
                      }
                  }
               },
               shadow: false,
               states: {
                  hover: {
                      lineWidth: 1
                  }
               }
            },
            spline: {
            lineWidth: 2,
            states: {
               hover: {
                  lineWidth: 5
               }
            },
            marker: {
               enabled: false,
               states: {
                  hover: {
                     enabled: true,
                     symbol: 'circle',
                     radius: 5,
                     lineWidth: 1
                  }
               }
            },
            pointInterval: 3600000, // one hour
            pointStart: Date.UTC(2009, 9, 6, 0, 0, 0)
         }
         },
         series: [
              <?php $count=0; ?>
              <?php foreach($data_log as $datalog) { ?>
               <?php if($count>0) echo ","; ?>
               {
               type: <?php echo "'".$datalog['type_graph']."'"; ?>,
               <?php if((isset($datalog['record1']))&&(!empty($datalog['record1']))&&(strcmp($datalog['record1'],"")!=0)) { ?>
                showCheckbox: true,
               <?php } ?>

               <?php if((strcmp($datalog['sensor_type'],"POWER")!=0)&&(strcmp($datalog['sensor_type'],"PROGRAM")!=0)) { ?>
                    <?php if($datalog['sensor_type']==2) {  ?>
                        name: <?php echo "'".clean_highchart_message($datalog['sensor_name_type'][0])." (".__('SENSOR')." ".$datalog['sensor_nb'].")'"; ?>,
                    <?php } else { ?>
                        name: <?php echo "'".clean_highchart_message($datalog['sensor_name_type'])." (".__('SENSOR')." ".$datalog['sensor_nb'].")'"; ?>,
                    <?php } ?>
               <?php } else { ?>
                    name: <?php echo "'".clean_highchart_message($datalog['sensor_name_type'])."'"; ?>,
               <?php } ?>
               <?php if(in_array($count,$unselected_graph)) { ?>
               visible: false,
               <?php } ?>
               yAxis: <?php echo $datalog['yaxis_record1']; ?>,
               pointInterval: <?php echo "$next"; ?> * 60 * 1000,
               pointStart: Date.UTC(<?php echo $styear.",".$stmonth.",".$stday; ?>),
                   <?php switch($datalog['color_record1']) {
                         case 'blue': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_BLUE'][$datalog['sensor_nb']-1]."',"; 
                            break;
                         case 'black': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_BLACK'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'green': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_GREEN'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'red': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_RED'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'purple': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_PURPLE'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'brown': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_BROWN'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'yellow': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_YELLOW'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'orange': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_ORANGE'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'pink': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_PINK'][$datalog['sensor_nb']-1]."',"; 
                            break;
               } ?>   
               selected: true,
               data: [
                  <?php if((isset($datalog['record1']))&&(!empty($datalog['record1']))) echo $datalog['record1']; ?>
               ],
               events: {
                    checkboxClick: function(event) {
                        var series = chart.series[<?php echo $count; ?>];
                        if (series.visible) {
                            var tmp="";
                            tmp=$("input[name='unselected_graph']").val();
                            if(tmp=="") {
                                $("input[name='unselected_graph']").val("<?php echo $count; ?>");
                            } else {
                                $("input[name='unselected_graph']").val(tmp+",<?php echo $count; ?>");
                            }
                            series.hide();
                        } else {
                            series.show();
                            var tmp="";
                            tmp=$("input[name='unselected_graph']").val();
                            if(tmp!="") {
                                var tmp_array=tmp.split(',');
                                tmp_array=jQuery.grep(tmp_array, function(value) {
                                    return value != <?php echo $count; ?>;
                                });
                                $("input[name='unselected_graph']").val(tmp_array.join(","));
                            }
                        }
                    }
               } 
              } 
              <?php if($datalog['sensor_type']==2) { ?>
               , {
               type: <?php echo "'".$datalog['type_graph']."'"; ?>,
               <?php if((isset($datalog["record2"]))&&(!empty($datalog["record2"]))&&(strcmp($datalog["record2"],"")!=0)) { ?>
                showCheckbox: true,
               <?php } ?>
               name: <?php echo "'".clean_highchart_message($datalog['sensor_name_type'][1])." (".__('SENSOR')." ".$datalog["sensor_nb"].")'"; ?>,
               <?php if(in_array($count+1,$unselected_graph)) { ?>
               visible: false,
               <?php } ?>
               pointInterval: <?php echo "$next"; ?> * 60 * 1000,
               pointStart: Date.UTC(<?php echo $styear.",".$stmonth.",".$stday; ?>),
                   <?php switch($datalog['color_record2']) {
                         case 'blue': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_BLUE'][$datalog['sensor_nb']-1]."',"; 
                            break;
                         case 'black': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_BLACK'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'green': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_GREEN'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'red': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_RED'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'purple': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_PURPLE'][$datalog['sensor_nb']-1]."',"; 
                            break;
                         case 'brown': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_BROWN'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'yellow': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_YELLOW'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'orange': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_ORANGE'][$datalog['sensor_nb']-1]."',"; 
                            break;
                        case 'pink': echo "color: '".$GLOBALS['LIST_GRAPHIC_COLOR_SENSOR_PINK'][$datalog['sensor_nb']-1]."',"; 
                            break;
               } ?>
               yAxis: <?php echo $datalog['yaxis_record2']; ?>,
               selected: true,
               data: [
                  <?php if((isset($datalog['record2']))&&(!empty($datalog['record2']))) echo $datalog['record2']; ?>
               ],
               events: {
                    checkboxClick: function(event) {
                        var series = chart.series[<?php echo $count+1; ?>];
                        if (series.visible) {
                            var tmp="";
                            tmp=$("input[name='unselected_graph']").val();
                            if(tmp=="") {
                                $("input[name='unselected_graph']").val("<?php echo $count+1; ?>");
                            } else {
                                $("input[name='unselected_graph']").val(tmp+",<?php echo $count+1; ?>");
                            }
                            series.hide();
                        } else {
                            series.show();
                            var tmp="";
                            tmp=$("input[name='unselected_graph']").val();
                            if(tmp!="") {
                                var tmp_array=tmp.split(',');
                                tmp_array=jQuery.grep(tmp_array, function(value) {
                                    return value != <?php echo $count+1; ?>;
                                });
                                $("input[name='unselected_graph']").val(tmp_array.join(","));
                            }
                        }
                    }
               }
              } 
              <?php } ?>
              <?php if($datalog['sensor_type']!=2) {
                    $count=$count+1;    
                } else { 
                    $count=$count+2;
                }
            } ?>
            ]
        });

    chart.series.each(function (item) {
        if(item.data=="") {
                item.options.showInLegend = false;
                item.legendItem = item.legendItem.destroy();;
                chart.legend.destroyItem(item);
        }
        chart.legend.render();
    });

    <?php foreach($unselected_graph as $i) { ?>
        chart.series[<?php echo $i; ?>].select(false);
    <?php } ?>

     });


    $('#resetXzoom').click(function() {
        if(showzoomX) {
            chart.zoomOut();
            showzoomX=false;
            $('#resetXzoom').css("display","none");
        }

    });
});


</script>
<label id="anchor-logs"></label>
<br />
<table class="table_width">
<tr>
    <td class="left_log"></td>
    <td class="center_log"></td>
    <td class="right_log"><?php if((!empty($resume_minmax))||(strcmp("$second_regul","True")==0)) { ?><img src="main/libs/img/resume.png" alt="" title="<?php if(!empty($resume_minmax)) { echo $resume_minmax; } if((!empty($resume_regul))&&(strcmp("$second_regul","True")==0)) { echo $resume_regul; } ?>" /><?php } ?></td>
</tr>
<tr>
    <td class="left_log">
        <?php if((strcmp("$type","month")!=0)||(($GLOBALS['FIRST_LOG_YEAR']!=$startyear)||($startmonth!=01))) { ?>
        <form action="display-logs-<?php echo $_SESSION['SHORTLANG']; ?>" method="post">
            <input type="submit" value="<" name="previous" class="button_log" title="<?php if(strcmp($type,"days")==0) echo __('PREVIOUS_BUTTON_DAY'); else echo __('PREVIOUS_BUTTON_MONTH'); ?>">
            <?php if(strcmp($type,"days")==0) { ?>
                <input type="hidden" name="startday" value="<?php echo date('Y-m-d',strtotime("-1 day", strtotime("$startday"))); ?>">
            <?php } else { ?>
                <?php 
                    if(strcmp("$startmonth","01")==0) {
                            $month="12"; 
                     } else {
                            $month=$startmonth-1;
                            if(strlen($month)<2) {
                                $month="0$month";
                            }
                    }
                ?>
                <input type="hidden" name="startmonth" value="<?php echo "$month"; ?>">
                <input type="hidden" name="startyear" value="<?php if(strcmp("$startmonth","01")==0) echo $startyear-1; else echo $startyear; ?>">
            <?php } ?>

            <input type="hidden" name="select_plug" value="<?php echo $select_plug; ?>">
            <input type="hidden" name="select_power_save" value="<?php echo implode(',', $select_power); ?>">
            <input type="hidden" name="select_sensor_save" value="<?php echo implode(',', $select_sensor); ?>">
            <input type="hidden" name="unselected_graph" value="<?php echo implode(',', $unselected_graph); ?>">
            <input type="hidden" name="anchor" value="anchor-logs">

            <input type="hidden" name="zoom_min_power" value="<?php if(isset($zoom_min_power)) { echo $zoom_min_power; }else { echo -1; } ?>">
            <input type="hidden" name="zoom_max_power" value="<?php if(isset($zoom_max_power)) { echo $zoom_max_power; }else { echo -1; } ?>">
            <input type="hidden" name="zoom_min_temp" value="<?php if(isset($zoom_min_temp)) { echo $zoom_min_temp; }else { echo -1; } ?>">
            <input type="hidden" name="zoom_max_temp" value="<?php if(isset($zoom_max_temp)) { echo $zoom_max_temp; }else { echo -1; } ?>">
            <input type="hidden" name="zoom_min_humi" value="<?php if(isset($zoom_min_humi)) { echo $zoom_min_humi; }else { echo -1; } ?>">
            <input type="hidden" name="zoom_max_humi" value="<?php if(isset($zoom_max_humi)) { echo $zoom_max_humi; }else { echo -1; } ?>">
        </form>
        <?php } ?>
    </td>
    <td class="center_log"><div id="container" style="width: 850px; height: 425px; margin: 0 auto"></div></td>
    <td class="right_log">
        <?php 
             $dd=date('d');    
             $yy=date('Y');
             $mm=date('m');

          if(((strcmp("$type","month")==0)&&(($startyear!=date('Y'))||($startmonth!=12)))||((strcmp("$type","days")==0)&&(strcmp("$startday","$yy-$mm-$dd")!=0))) { 
        ?>
        <form action="display-logs-<?php echo $_SESSION['SHORTLANG']; ?>" method="post">
            <input type="submit" value=">" name="next" class="button_log" title="<?php if(strcmp($type,"days")==0) echo __('NEXT_BUTTON_DAY'); else echo __('NEXT_BUTTON_MONTH'); ?>">
            <?php if(strcmp($type,"days")==0) { ?>
                <input type="hidden" name="startday" value="<?php echo date('Y-m-d',strtotime("+1 day", strtotime("$startday"))); ?>">
            <?php } else { ?>
                <?php 
                    if(strcmp("$startmonth","12")==0) {
                            $month="01"; 
                     } else {
                            $month=$startmonth+1;
                            if(strlen($month)<2) {
                                $month="0$month";
                            }
                    }
                ?>
                <input type="hidden" name="startmonth" value="<?php echo "$month"; ?>">
                <input type="hidden" name="startyear" value="<?php if(strcmp("$startmonth","12")==0) echo $startyear+1; else echo $startyear; ?>" >
            <?php } ?>

            <input type="hidden" name="select_plug" value="<?php echo $select_plug; ?>">
            <input type="hidden" name="select_power_save" value="<?php echo implode(',', $select_power); ?>">
            <input type="hidden" name="select_sensor_save" value="<?php echo implode(',', $select_sensor); ?>">
            <input type="hidden" name="unselected_graph" value="<?php echo implode(',', $unselected_graph); ?>">
            <input type="hidden" name="anchor" value="anchor-logs">

            <input type="hidden" name="zoom_min_power" value="-1">
            <input type="hidden" name="zoom_max_power" value="-1">
            <input type="hidden" name="zoom_min_temp" value="-1">
            <input type="hidden" name="zoom_max_temp" value="-1">
            <input type="hidden" name="zoom_min_humi" value="-1">
            <input type="hidden" name="zoom_max_humi" value="-1">
        </form>
        <?php } ?>
    </td>
</tr>
</table>
<p class="p_center"><button id="resetXzoom" name="buttonX" style="display:none"><?php echo __('RESET_ZOOM_TITLE'); ?></button> <button id="resetzoom" name="button" style="display:none"><?php echo __('RESET_ZOOM_TITLE'); ?></button></p>
<p class="precision_infos">
<?php if(strcmp($type,"days")==0)  echo "*"." ".__('PRECISION_GRAPH_DAY'); else echo "*"." ".__('PRECISION_GRAPH_MONTH'); ?>
</p>
<hr />
<br />
<br />
<br />

<label class="title_conf"><?php echo __('MANAGE_LOG_INFOS'); ?></label>
<form action="<?php echo($_SERVER['PHP_SELF']); ?>" method="post">
<table class="table_width">
<tr>
    <td class="log-manage-marge"></td>
    <td class="log-manage-title"><?php echo __('IMPORT_LOG_TITLE')." "; ?>
        <select name="log_search" id="log_search">
        <?php foreach($GLOBALS['LOG_SEARCH'] as $value) {
                   if($value==$import_load) {
                        echo "<option value=\"${value}\" selected>${value}</option>";
                   } else {
                        echo "<option value=\"${value}\">${value}</option>";
                   }
        } ?>
         </select>
        <?php echo __('IMPORT_LAST_MONTH'); ?><img src="main/libs/img/infos.png" alt="" title="<?php echo __('TOOLTIP_CONFIG_LOG_SEARCH'); ?>" />
    <td class="log-manage-field"><input type="submit" id="import_log" name="import_log" <?php if((!isset($sd_card))||(empty($sd_card))) { echo "disabled"; ?> class="inputDisable" value="<?php echo __('NO_IMPORT_LOG'); ?>" <?php } else { ?>value="<?php echo __('IMPORT_LOG'); ?>" <?php } ?>
></td>
    <td></td>
</tr>
</table>
</form>


<div id="progress_load" title="<?php echo __('LOAD_LOG_PROGRESS'); ?>" style="display:none">
    <p><?php echo __('PROGRESS_LOG'); ?>:</p>
    <div id="progress_bar_load"></div>
    <p class="p_center">
        <label class="format_success" id="success_load" style="display:none"><?php echo __('VALID_LOAD_LOG'); ?></label>
        <label class="format_error" id="error_load" style="display:none"><?php echo __('ERROR_LOAD_LOG'); ?></label>
        <label class="format_success" id="success_load_auto" style="display:none"><?php echo __('VALID_AUTO_LOAD_LOG'); ?></label>
    </p>

    <br />
    <p><?php echo __('PROGRESS_POWER'); ?>:</p>

    <div id="progress_bar_load_power"></div>
    <p class="p_center">
        <label class="format_success" id="success_load_power" style="display:none"><?php echo __('VALID_LOAD_LOG'); ?></label>
        <label class="format_error" id="error_load_power" style="display:none"><?php echo __('ERROR_LOAD_LOG'); ?></label>
        <label class="format_success" id="success_load_power_auto" style="display:none"><?php echo __('VALID_AUTO_LOAD_LOG'); ?></label>
    </p>
    <br />
        <label class="format_success" id="success_load_still_log" style="display:none"><?php echo __('STILL_LOG_FILE'); ?></label>
</div>

<form action="display-logs-<?php echo $_SESSION['SHORTLANG']; ?>" method="post" id="reset_log_form">
<table class="table_width">
<tr>
    <td class="log-manage-marge"></td>
    <td class="log-manage-title"><?php echo __('MANAGE_RESET_TITLE'); ?><img src="main/libs/img/infos.png" alt="" title="<?php echo __('TOOLTIP_RESET_LOG'); ?>" /></td>
    <td class="log-manage-field"><input type="submit" id="reset_log_submit" name="reset_log_submit" <?php if(!$check_log) { echo 'disabled'; ?> class="inputDisable" value="<?php echo __('MANAGE_EXPORT_EMPTY_LOG_CSV'); ?>" <?php } else { ?>value="<?php echo __('MANAGE_RESET_LOG'); ?>" <?php } ?>></td>
    <td></td>
</tr>
</table>
    <input type="hidden" name="anchor" value="anchor-manage">
</form>


<form action="display-logs-<?php echo $_SESSION['SHORTLANG']; ?>" method="post" >
<table class="table_width">
<tr>
    <td class="log-manage-marge"></td>
    <td class="log-manage-title"><?php echo __('MANAGE_EXPORT_LOG_CSV'); ?><img src="main/libs/img/infos.png" alt="" title="<?php echo __('TOOLTIP_EXPORT_LOG_CSV'); ?>" /></td>
    <td class="log-manage-field"><INPUT type="submit" id="export_log" name="export_log" <?php if(!$check_log) { echo 'disabled'; ?> class="inputDisable" value="<?php echo __('MANAGE_EXPORT_EMPTY_LOG_CSV'); ?>" <?php } else { ?> value="<?php echo __('MANAGE_EXPORT_LOG_CSV_BUTTON'); ?>"<?php } ?>></td>
    <td></td>
</tr>
</table>
<input type="hidden" name="quick_load" value="True">
<input type="hidden" name="select_plug" value="<?php echo $select_plug; ?>">
<input type="hidden" name="select_power_save" value="<?php echo implode(',', $select_power); ?>">
<input type="hidden" name="select_sensor_save" value="<?php echo implode(',', $select_sensor); ?>">
<input type="hidden" name="anchor" value="anchor-manage">
<?php if(strcmp("$type","month")==0) { ?>
<input type="hidden" name="startmonth" value="<?php echo "$startmonth"; ?>">
<input type="hidden" name="startyear" value="<?php echo "$startyear"; ?>" >
<?php } else { ?>
<input type="hidden" name="startday" value="<?php echo "$startday"; ?>">
<?php } ?>
</form>




<label id="anchor-manage"></label>
<form action="display-logs-<?php echo $_SESSION['SHORTLANG']; ?>" method="post" id="reset_log_power_form">
<table class="table_width">
<tr>
    <td class="log-manage-marge"></td>
    <td class="log-manage-title"><?php echo __('MANAGE_RESET_TITLE_POWER'); ?><img src="main/libs/img/infos.png" alt="" title="<?php echo __('TOOLTIP_RESET_LOG'); ?>" /></td>
    <td class="log-manage-field"><input type="submit" id="reset_log_power_submit" name="reset_log_power_submit" <?php if(!$check_power) { echo 'disabled'; ?> class="inputDisable" value="<?php echo __('MANAGE_EXPORT_EMPTY_POWER_CSV'); ?>" <?php } else { ?> value="<?php echo __('MANAGE_RESET_POWER'); ?>" <?php } ?>></td>
    <td></td>
</tr>
</table>
     <input type="hidden" name="anchor" value="anchor-manage">
</form>


<form action="display-logs-<?php echo $_SESSION['SHORTLANG']; ?>" method="post" >
<table class="table_width">
<tr>
    <td class="log-manage-marge"></td>
    <td class="log-manage-title"><?php echo __('MANAGE_EXPORT_POWER_CSV'); ?><img src="main/libs/img/infos.png" alt="" title="<?php echo __('TOOLTIP_EXPORT_POWER_CSV'); ?>" /></td>
    <td class="log-manage-field"><INPUT type="submit" id="export_log_power" name="export_log_power"  <?php if(!$check_power) { echo 'disabled'; ?> class="inputDisable" value="<?php echo __('MANAGE_EXPORT_EMPTY_POWER_CSV'); ?>" <?php } else { ?>  value="<?php echo __('MANAGE_EXPORT_POWER_CSV_BUTTON'); ?>"<?php } ?>></td>
    <td></td>
</tr>
</table>
<input type="hidden" name="quick_load" value="True">
<input type="hidden" name="select_plug" value="<?php echo $select_plug; ?>">
<input type="hidden" name="select_power_save" value="<?php echo implode(',', $select_power); ?>">
<input type="hidden" name="select_sensor_save" value="<?php echo implode(',', $select_sensor); ?>">
<?php if(strcmp("$type","month")==0) { ?>
<input type="hidden" name="startmonth" value="<?php echo "$startmonth"; ?>">
<input type="hidden" name="startyear" value="<?php echo "$startyear"; ?>" >
<?php } else { ?>
<input type="hidden" name="startday" value="<?php echo "$startday"; ?>">
<?php } ?>
</form>


<div id="delete_log_form" title="<?php echo __('MANAGE_RESET_TITLE'); ?>" style="display:none">
        <table class="table_width">
            <tr>
                <td class="delete_message_border"><b><?php echo __('DELETE_ALL_LOGS'); ?>:</b></td>
                <td><input id="check_delete_all" name="check_type_delete" type="radio" value="all" checked/></td>
            </tr>
        </table>
        <br />
        <table class="table_width">
            <tr>
                <td class="delete_message_border"><b><?php echo __('DELETE_SPECIFIC_LOGS'); ?>:</b></td>
                <td><input id="check_delete_specific" name="check_type_delete" type="radio" value="specific"/></td>
            </tr>
        </table>
        <div id="div_delete_specific" style="display:none">
        <br />
        <hr />
        <br />
        <table class="table_width">
            <tr>
                <td class="field_delete_form"><?php echo __('DELETE_LOGS_FROM'); ?>: <input id="datepicker_from" name="delete_startday" type="text" class="whitefield" size="10" value="<?php echo $startday; ?>"><?php echo __('DELETE_LOGS_TO'); ?>: <input id="datepicker_to" name="delete_endday" type="text" class="whitefield" size="10" value="<?php echo $startday; ?>"></td>
                <td></td>
            </tr>
        </table>
        </div>

        <br />
        <br />
        <p class="p_center">
            <label class="format_error" id="error_format_date_logs" style="display:none"><?php echo __('ERROR_FORMAT_DATE'); ?></label>
        </p>

        <div id="progress_delete_logs" style="display:none">
            <p><?php echo __('DELETE_PROGRESS'); ?>:</p>
            <div id="progress_bar_delete_logs"></div>
            <br />
            <p class="p_center">
                <label class="format_success" id="success_delete_logs" style="display:none"><?php echo __('VALID_DELETE_LOGS'); ?></label>
                <label class="format_error" id="error_delete_logs" style="display:none"><?php echo __('ERROR_DELETE_LOGS'); ?></label>
            </p>
        </div>
</div>


<div id="delete_log_form_power" title="<?php echo __('MANAGE_RESET_TITLE_POWER'); ?>" style="display:none">
        <table class="table_width">
            <tr>
                <td class="delete_message_border"><b><?php echo __('DELETE_ALL_LOGS'); ?>:</b></td>
                <td><input id="check_delete_all_power" name="check_type_delete_power" type="radio" value="all" checked/></td>
            </tr>
        </table>
        <br />
        <table class="table_width">
            <tr>
                <td class="delete_message_border"><b><?php echo __('DELETE_SPECIFIC_LOGS'); ?>:</b></td>
                <td><input id="check_delete_specific_power" name="check_type_delete_power" type="radio" value="specific"/></td>
            </tr>
        </table>
        <div id="div_delete_specific_power" style="display:none">
        <br />
        <hr />
        <br />
        <table class="table_width">
            <tr>
                <td class="field_delete_form"><?php echo __('DELETE_LOGS_FROM'); ?>: <input id="datepicker_from_power" name="delete_startday" type="text" class="whitefield" size="10" value="<?php echo $startday; ?>"><?php echo __('DELETE_LOGS_TO'); ?>: <input id="datepicker_to_power" name="delete_endday" type="text" class="whitefield" size="10" value="<?php echo $startday; ?>"></td>
                <td></td>
            </tr>
        </table>
        </div>

        <br />
        <br />
        
        <p class="p_center">
            <label class="format_error" id="error_format_date_logs_power" style="display:none"><?php echo __('ERROR_FORMAT_DATE'); ?></label>
        </p>

        <div id="progress_delete_logs_power" style="display:none">
            <p><?php echo __('DELETE_PROGRESS'); ?>:</p>
            <div id="progress_bar_delete_logs_power"></div>
            <br />
            <p class="p_center">
                <label class="format_success" id="success_delete_logs_power" style="display:none"><?php echo __('VALID_DELETE_LOGS'); ?></label>
                <label class="format_error" id="error_delete_logs_power" style="display:none"><?php echo __('ERROR_DELETE_LOGS'); ?></label>
            </p>
        </div>
</div>


<br />
<br />
<br />
