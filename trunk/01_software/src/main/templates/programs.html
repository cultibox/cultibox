<div id="info">
<ul>
        <?php echo $info; ?>
</ul>
</div>

<div id="error">
<ul>
        <?php echo $return; ?>
</ul>
</div>

<?php for($i=1;$i<=$nb_plugs;$i++) { ?>

<script type="text/javascript">
$(document).ready(function(){
$('#start_time<?php echo $i; ?>').timepicker({
timeOnlyTitle: '<?php echo __(TIMEPICKER_SELECT_TIME); ?>',
showSecond: true,
showOn: 'both',
timeFormat: 'hh:mm:ss',
timeText: '<?php echo __(TIMEPICKER_TIME); ?>',
hourText: '<?php echo __(TIMEPICKER_HOUR); ?>',
minuteText: '<?php echo __(TIMEPICKER_MINUTE); ?>',
secondText: '<?php echo __(TIMEPICKER_SECOND); ?>',
currentText: '<?php echo __(TIMEPICKER_NOW); ?>'
});
$('#end_time<?php echo $i; ?>').timepicker({
timeOnlyTitle: '<?php echo __(TIMEPICKER_SELECT_TIME); ?>',
showOn: 'both',
showSecond: true,
timeFormat: 'hh:mm:ss',
timeText: '<?php echo __(TIMEPICKER_TIME); ?>',
hourText: '<?php echo __(TIMEPICKER_HOUR); ?>',
minuteText: '<?php echo __(TIMEPICKER_MINUTE); ?>',
secondText: '<?php echo __(TIMEPICKER_SECOND); ?>',
currentText: '<?php echo __(TIMEPICKER_NOW); ?>'
});
});
</script>


<script type="text/javascript">
var chart;
$(document).ready(function() {
	chart = new Highcharts.Chart({
		chart: {
			backgroundColor: '#F7F7F9',
			renderTo: 'plug<?php echo $i;?>',
			type: 'spline',
	                zoomType: 'x'
		},
		title: {
			text: <?php echo "'".__(CURRENT_PLUG_PROGRAM)." ".$plugs_infos[$i-1][PLUG_NAME]."'"; ?>
		},
		xAxis: {
			type: 'datetime',
			dateTimeLabelFormats: { // don't display the dummy year
				hours: '%H',
				minutes: '%M',
				seconds: '%S'
			},
			min: 0,
			max: 86399999
		},
		yAxis: {
			<?php if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"lamp")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"unknown")==0)) { ?>
				min: -0.5,
				max: 1.5,
<?php } else if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"ventilator")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"heating")==0)) { ?>
				min: -0.5,
				max: 100,
<?php } else if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"humidifier")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"dehumidifier")==0)) { ?>
				min: -0.5,
				max: 100,
<?php } else { ?>
				min: -0.5,
				max: 1.5,
<?php } ?>
        		labels: {
            			formatter: function() {
					<?php if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"lamp")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"unknown")==0)) { ?>
					if(this.value==0) return '<?php echo __(VALUE_OFF); ?>';
					if(this.value==1) return '<?php echo __(VALUE_ON); ?>';
<?php } else if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"ventilator")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"heating")==0)) { ?>
					if(this.value>0) return this.value+'°C';
					if(this.value==0) return '<?php echo __(VALUE_OFF); ?>';

<?php } else if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"humidifier")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"dehumidifier")==0)) { ?>
					if(this.value>0) return this.value+'%';
					if(this.value==0) return '<?php echo __(VALUE_OFF); ?>';

<?php } else { ?>
					return this.value;

<?php } ?>
            			}
        		},
			title: false
		},
            	credits: {
                        enabled: false
                },
		tooltip: {
			formatter: function() {

  <?php if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"lamp")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"unknown")==0)) { ?>
		if(this.y == 1) {
			return Highcharts.dateFormat('%H:%M:%S', this.x) +'<br /><p align=center><b><?php echo __(VALUE_ON); ?></b></p>';
		} else {
			return Highcharts.dateFormat('%H:%M:%S', this.x) +'<br /><p align=center><b><?php echo __(VALUE_OFF); ?></b></p>';
		}
<?php } else if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"ventilator")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"heating")==0)) { ?>
		return Highcharts.dateFormat('%H:%M:%S', this.x) +'<br /><p align=center><b>'+this.y+'°C</b></p>';

<?php } else if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"humidifier")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"dehumidifier")==0)) { ?>
		return Highcharts.dateFormat('%H:%M:%S', this.x) +'<br /><p align=center><b>'+this.y+'%</b></p>';
<?php } else { ?>
		return Highcharts.dateFormat('%H:%M:%S', this.x) +'<br /><p align=center><b>'+this.y+'</b></p>';
<?php } ?>

			}
		},
		
		series: [{
			name: <?php echo "'".__(BEHAVIOUR_PLUG_PROGRAM_TITLE)." (".$plugs_infos[$i-1][translate].")',"; ?>
			color: <?php echo "'".$GLOBALS['LIST_GRAPHIC_COLOR_PROGRAM'][$i-1]."'"; ?>,
			data: [
				<?php echo $plugs_infos[$i-1][data]; ?>
			]
		}]
	});
});

</script>
<br />

<form action="<?php echo($_SERVER['PHP_SELF']); ?>#conf<?php echo $i; ?>" method="post">
<table width="100%" id="conf<?php echo $i; ?>" >
	<tr>
		<td width="50%"><p class="title_conf"><?php echo __(CONFIGURE_PROGRAM); ?>:</p></td>
		<td></td>
	</tr>
	<tr>
		<td>
			<table>
				<tr>
					<td width="20%"></td>
					<td width="50%"><?php echo __(START_TIME_PROGRAM); ?></td>
					<td width="30%"><input type="text" size="10" name="start_time<?php echo $i; ?>" id="start_time<?php echo $i; ?>" <?php if(($i==$selected_plug)&&(!empty($start_time))) { ?>value="<?php echo $start_time;?>" <?php } ?> /></td>
				</tr>
				<tr>
					<td></td>
					<td><?php echo __(END_TIME_PROGRAM); ?></td>
					<td><input type="text" size="10" name="end_time<?php echo $i; ?>" id="end_time<?php echo $i; ?>" <?php if(($i==$selected_plug)&&(!empty($end_time))) { ?>value="<?php echo $end_time;?>" <?php } ?> /></td>
				</tr>
				<tr>
					<td></td>
					<td><?php echo __(VALUE_ON_OFF); ?></td>
					<td><?php if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"lamp")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"unknown")==0)) { ?>
						<select name="value_program<?php echo $i; ?>">
        						<option value="off" <?php if(($i==$selected_plug)&&($value_program==0)) { ?>selected<?php } ?>><?php echo __(VALUE_OFF); ?></option>
        						<option value="on" <?php if(($i==$selected_plug)&&($value_program==1)) { ?>selected<?php } ?>><?php echo __(VALUE_ON); ?></option>
        					</select>
					<?php } else { ?>
        					<input type="text" name="value_program<?php echo $i; ?>" size="4" maxlength="4" <?php if(($i==$selected_plug)&&(!empty($value_program))) { ?>value="<?php echo $value_program;?>" <?php } ?> />
                                                <?php if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"heating")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"ventilator")==0)) echo "°C"; ?>
						<?php if((strcmp($plugs_infos[$i-1][PLUG_TYPE],"humidifier")==0)||(strcmp($plugs_infos[$i-1][PLUG_TYPE],"dehumidifier")==0)) echo "%"; ?>
					<?php } ?>
					</td>
				</tr>
				<tr>
					<td></td>
					<td align="right"><br /><input type="hidden" name="selected_plug" value="<?php echo $i; ?>">
						<input type="submit" name="apply" value="<?php echo __(APPLY_PROGRAM); ?>">
					</td>
					<td></td>
				</tr>
			</table>
		</td>
		<td width="100%"><div id="plug<?php echo $i; ?>" style="width: 80%; height: 300px; margin: 0 auto"></div></td>
	</tr>
</table>
</form>
<div id="error">
<ul>
<?php if((isset($ret_plug[$i]))&&(!empty($ret_plug[$i]))) echo $ret_plug[$i]; ?>
</ul>
</div>
<div id="info">
<ul>
<?php if((isset($info_plug[$i]))&&(!empty($info_plug[$i]))) echo $info_plug[$i]; ?>
</ul>
</div>
<br /><br /><br />

<?php } ?>
