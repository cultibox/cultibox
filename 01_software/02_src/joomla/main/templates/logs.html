<script type="text/javascript">
function verifDate(e) {
   if((e.keyCode < 45 || e.keyCode > 57)&&(e.keyCode != 08 && e.keyCode != 10 && e.keyCode != 13)) e.returnValue = false;
   if((e.which < 45 || e.which > 57)&&(e.which != 08 && e.which != 10 && e.which != 13)) return false;
}
</script>


<?php if((isset($pop_up))&&("$pop_up"!="False")&&(isset($pop_up_message))&&(!empty($pop_up_message))) { ?>
   <SCRIPT LANGUAGE="JavaScript">
      alert('<?php echo "$pop_up_message"; ?>');
   </SCRIPT>
<?php } else if((isset($pop_up))&&("$pop_up"!="False")&&(isset($pop_up_error_message))&&(!empty($pop_up_error_message))) { ?>
   <SCRIPT LANGUAGE="JavaScript">
      alert('<?php echo "$pop_up_error_message"; ?>');
   </SCRIPT>
<?php } ?>


<?php if((isset($info))&&(!empty($info))) { ?>
   <div id="info">
      <ul>
         <?php echo $info; ?>
      </ul>
   </div>
<?php } ?>

<?php if((!empty($main_error))||(!empty($error))) { ?>
<div id="error">
<?php if(!empty($main_error)) { ?>
<ul>
        <?php echo $main_error; ?>
</ul>
<?php } ?>
<?php if(!empty($error)) { ?>
<ul>
        <?php echo $error; ?>
</ul>
<?php } ?>
</div>
<?php } ?>

<?php switch($lang) {

	case 'fr_FR': 
                echo '<script type="text/javascript" src="main/libs/js/jquery.ui.datepicker-fr.js"></script>'; 
		break;
        }
?>

<script>
$(function() {
   $("#datepicker").datepicker({ 
dateFormat: "yy-mm-dd",
showButtonPanel: true,
showOn: "both",
buttonImage: "../main/libs/img/datepicker.png",
buttonImageOnly: 'true',
<?php echo "buttonText: '".__('TIMEPICKER_BUTTON_TEXT_LOG')."',"; ?>
}).val()
});
</script>

<form action="/cultibox/index.php/display-logs" method="post">
<p class="title_conf"><img src="main/libs/img/arrow.png" alt="" /><?php echo __('SELECT_DISPLAYED_DAY'); ?></p>

<table>
   <tr>
      <td class="log-marge-day"></td>
      <td class="log-marge-day-title"><?php echo __('SELECT_DAY'); ?>:</td>
      <td class="log-marge-day-field"><input id="datepicker" name="startday" type="text" class="whitefield" size="10" value="<?php echo $startday; ?>"></td>
   </tr>
   <tr>
      <td></td>
      <td><?php echo __('SELECT_PROGRAM_PLUG'); ?><img src="main/libs/img/infos.png" alt="" class="info-bulle-css" title="<?php echo __('TOOLTIP_LOG_PROGRAM'); ?>" /></td>
      <td> <select name="select_plug">
            <option value="">---</option>
            <?php for($i=0;$i<$nb_plugs;$i++) { ?>
               <option value="<?php echo $plugs_infos[$i]["id"]; ?>" <?php if(strcmp($select_plug,$plugs_infos[$i]["id"])==0) echo "selected"; ?>><?php echo $plugs_infos[$i]["PLUG_NAME"]; ?></option>
            <?php } ?>
         </select>
      </td>
   </tr>
   <tr>
      <td></td>
      <td><?php echo __('SELECT_POWER_PLUG'); ?><img src="main/libs/img/infos.png" alt="" class="info-bulle-css" title="<?php echo __('TOOLTIP_POWER_LOG'); ?>" /></td>
      <td> <select name="select_power">
            <option value="">---</option>
            <?php for($i=0;$i<$nb_plugs;$i++) { ?>
               <option value="<?php echo $plugs_infos[$i]["id"]; ?>" <?php if(strcmp($select_power,$plugs_infos[$i]["id"])==0) echo "selected"; ?>><?php echo $plugs_infos[$i]["PLUG_NAME"]; ?></option>
            <?php } ?>
               <option value="999" <?php if(strcmp($select_power,999)==0) echo "selected"; ?>><?php echo __('SELECT_ALL_PLUGS'); ?></option>
         </select>
      </td>
   </tr>
   <tr>
   <td></td>
   <td>
         <p class="p_right"><INPUT type="submit" value=<?php echo __('VIEW'); ?> onKeypress="return verifDigit(event);"></p>
   </td>
   <td></td>
</tr>
</table>
</form>
<hr />
<br />
<form action="/cultibox/index.php/display-logs" method="post">
<table>
   <tr>
      <td class="log-marge-month-title"><p class="title_conf"><img src="main/libs/img/arrow.png" alt="" /><?php echo __('SELECT_DISPLAYED_MONTH'); ?>:</p></td>
      <td class="log-marge-month-field">
            <select name="startmonth">
               <option <?php if("$startmonth" == "1") { echo 'selected';} ?> value="01"><?php echo __('MONTH01'); ?></option>
               <option <?php if("$startmonth" == "2") { echo 'selected';} ?> value="02"><?php echo __('MONTH02'); ?></option>
               <option <?php if("$startmonth" == "3") { echo 'selected';} ?> value="03"><?php echo __('MONTH03'); ?></option>
               <option <?php if("$startmonth" == "4") { echo 'selected';} ?> value="04"><?php echo __('MONTH04'); ?></option>
               <option <?php if("$startmonth" == "5") { echo 'selected';} ?> value="05"><?php echo __('MONTH05'); ?></option>
               <option <?php if("$startmonth" == "6") { echo 'selected';} ?> value="06"><?php echo __('MONTH06'); ?></option>
               <option <?php if("$startmonth" == "7") { echo 'selected';} ?> value="07"><?php echo __('MONTH07'); ?></option>
               <option <?php if("$startmonth" == "8") { echo 'selected';} ?> value="08"><?php echo __('MONTH08'); ?></option>
               <option <?php if("$startmonth" == "9") { echo 'selected';} ?> value="09"><?php echo __('MONTH09'); ?></option>
               <option <?php if("$startmonth" == "10") { echo 'selected';} ?> value="10"><?php echo __('MONTH10'); ?></option>
               <option <?php if("$startmonth" == "11") { echo 'selected';} ?> value="11"><?php echo __('MONTH11'); ?></option>
               <option <?php if("$startmonth" == "12") { echo 'selected';} ?> value="12"><?php echo __('MONTH12'); ?></option>
            </select>
            <?php if($GLOBALS['FIRST_LOG_YEAR']==$last_year) {
                  echo '<input type="text" name="startyear" value="'.$last_year.'" size="4" readonly="readonly">';
            }

            if($GLOBALS['FIRST_LOG_YEAR']!=$last_year) {
                 echo '<select name="startyear">';
                 $first=$GLOBALS['FIRST_LOG_YEAR'];
                 for($i=$first;$i<=$last_year;$i++) { ?>
                     <option <?php if("$startyear" == "$i") { echo 'selected';} ?> value="<?php echo $i; ?>"><?php echo $i; ?></option>
                  <?php }
                  echo "</select>";
            } ?>
      </td>
     <td class="log-marge-month"></td>
   </tr>
   <tr>
      <td></td>
      <td><p class="p_center"><INPUT type="submit" value=<?php echo __('VIEW'); ?>></p></td>
      <td></td>
   </tr>
</table>
</form>
<hr />


<?php if($check_format) { ?>
<script type="text/javascript">

Highcharts.setOptions({
lang: {
<?php echo "resetZoom : '".__('RESET_ZOOM')."',"; ?>
<?php echo "resetZoomTitle : '".__('RESET_ZOOM_TITLE')."'"; ?>
}
});

$(function () {
   var chart;
   $(document).ready(function() {
      chart = new Highcharts.Chart({
         chart: {
            backgroundColor: '#F7F7F9',
            renderTo: 'container',
            zoomType: 'x',
            spacingRight: 20,
            events: {
               load: function() {
                  <?php if($fake_log) echo "this.renderer.image('http://localhost:".$GLOBALS['SOFT_PORT']."/cultibox/main/libs/img/fake_log_".__('LANG').".png', 80, 55, 143, 57)"; ?>
                  <?php if($fake_log)  echo ".add();"; ?>
               }
            }
         },
         title: {
             text: <?php echo "'".__('HISTO_GRAPH')." (".$legend_date.")'"; ?>,
         },
         subtitle: {
             text: document.ontouchstart === undefined ?
               <?php echo "'".__('DRAG_PLOT')."'"; ?>:
               <?php echo "'".__('DRAG_PLOT')."'"; ?>
         },
         lang: {
            printButtonTitle: <?php echo "'".__('PRINT_HIGHCHART')."',"; ?>
            exportButtonTitle: <?php echo "'".__('EXPORT_HIGHCHART')."',"; ?>
            downloadPNG : <?php echo "'".__('EXPORT_PNG')."',"; ?>
            downloadJPEG : <?php echo "'".__('EXPORT_JPEG')."',"; ?>
            downloadPDF : <?php echo "'".__('EXPORT_PDF')."',"; ?>
            downloadSVG : <?php echo "'".__('EXPORT_SVG')."',"; ?>
            resetZoom : <?php echo "'".__('RESET_ZOOM')."',"; ?>
            resetZoomTitle : <?php echo "'".__('RESET_ZOOM_TITLE')."'"; ?>
         },
         xAxis: {
            type: 'datetime',
            <?php if("$type"=="month") { echo "tickInterval: 5 * 24 * 3600 * 1000,"; } ?>
            title: {
               text: <?php echo "'".__("$xlegend")."'"; ?>
            }
         },
         yAxis: [
            {
               title: {
                  text: <?php echo "'".__('YAXIS_LEGEND')."'"; ?>,
                  style: {
                     color: <?php echo "'".$color_humidity."'"; ?>
                  }
               },
               min: -0.5,
               max: <?php echo "$hygro_axis"; ?>,
               startOnTick: false,
               showFirstLabel: false,
               labels: {
                  formatter: function() {
                     if(this.value<=100) return this.value;
                  }
               }
            }, {
               title: {
                  text: <?php echo "'".__('Y2AXIS_LEGEND')."'"; ?>,
                  style: {
                     color: <?php echo "'".$color_temperature."'"; ?>
                  }
               },
               min: 0,
               max: <?php echo "$temp_axis"; ?>,
               startOnTick: false,
               showFirstLabel: false,
               opposite: true,
               labels: {
                  formatter: function() {
                     if(this.value<=100) return this.value;
                  }
               }
            }
            <?php if((isset($datap))&&(!empty($datap))) { ?>
            ,{
               title: {
                  text: <?php echo "'".__('Y3AXIS_LEGEND')."'"; ?>,
                  style: {
                     color: <?php echo "'".$color_power."'"; ?>
                  }
               },
               min: 0,
               max: <?php echo "$power_axis"; ?>,
            }
            <?php } ?>

         ],
         tooltip: {
            formatter: function() {
               var tab=new Array;
               <?php if("$type"=="month") { ?>
                  var val="<p align='left'><b><?php echo __('XAXIS_LEGEND_DAY'); ?>:  </b>"+Highcharts.dateFormat('%H:%M:%S %Y/%m/%d', this.x)+"</p>";
               <?php } else { ?>
                  var val="<p align='left'><b><?php echo __('XAXIS_LEGEND_DAY'); ?>:  </b>"+Highcharts.dateFormat('%H:%M:%S', this.x)+"</p>"; 
               <?php } ?>

                  var unit = {
               <?php echo "'".__('LEGEND_HUMI')."'"; ?>: '%',
               <?php echo "'".__('LEGEND_TEMP')."'"; ?>: 'Â°C', 
               <?php echo "'".__('LEGEND_POWER')."'"; ?>: 'W'
               <?php if((isset($select_plug))&&(!empty($select_plug))) {
                     echo ",'".$plugs_infos[$select_plug-1]["PLUG_NAME"]."': ''"; 
               }?>
            }[this.series.name];

            if(unit=='') { 
               if(this.y==99.9) {
                     behaviour='<?php echo __("VALUE_ON"); ?>';
               } else {
                     behaviour='<?php echo __("VALUE_OFF"); ?>';
               }
               return val+ "<p align='left'><b>"+ this.series.name+":</b>"+behaviour+"</p>";
            } else {
               return val+ "<p align='left'><b>"+ this.series.name+":</b>"+this.y + unit+"</p>";
            }
          }
         },
         legend: {
            enabled: true
         },
         credits: {
            enabled: false
         },
         plotOptions: {
            area: {
               fillColor: {
                  linearGradient: { x1: 3, y1: 0, x2: 0, y2: 1}, 
                  stops: [
                      [0, Highcharts.getOptions().colors[0]],
                      [1, 'rgba(2,0,0,0)']
                  ]
               
               },
               lineWidth: 1,
               marker: {
                  enabled: false,
                  states: {
                      hover: {
                          enabled: true,
                          radius: 5
                      }
                  }
               },
               shadow: false,
               states: {
                  hover: {
                      lineWidth: 1
                  }
               }
            },
            spline: {
            lineWidth: 2,
            states: {
               hover: {
                  lineWidth: 5
               }
            },
            marker: {
               enabled: false,
               states: {
                  hover: {
                     enabled: true,
                     symbol: 'circle',
                     radius: 5,
                     lineWidth: 1
                  }
               }
            },
            pointInterval: 3600000, // one hour
            pointStart: Date.UTC(2009, 9, 6, 0, 0, 0)
         }
         },

         series: [
            {
               type: 'area',
               name: <?php echo "'".__('LEGEND_HUMI')."'"; ?>,
               pointInterval:  <?php echo "$next"; ?> * 60 * 1000,
               pointStart: Date.UTC(<?php echo $styear.",".$stmonth.",".$stday; ?>),
               color: <?php echo "'".$color_humidity."'"; ?>,
               data: [
                  <?php if((isset($data_humi))&&(!empty($data_humi))) echo "$data_humi"; ?>
               ]
            }, {
               type: 'area',
               name: <?php echo "'".__('LEGEND_TEMP')."'"; ?>,
               pointInterval: <?php echo "$next"; ?> * 60 * 1000,
               pointStart: Date.UTC(<?php echo $styear.",".$stmonth.",".$stday; ?>),
               color: <?php echo "'".$color_temperature."'"; ?>,
               yAxis: 1,
               data: [
                  <?php if((isset($data_temp))&&(!empty($data_temp))) echo "$data_temp"; ?>
               ]
               <?php if((isset($datap))&&(!empty($datap))) { ?>
               }, {
                  type: 'spline',
                  pointInterval:  <?php echo "$next"; ?> * 60 * 1000,
                  pointStart: Date.UTC(<?php echo $styear.",".$stmonth.",".$stday; ?>),
                  name: <?php echo "'".__('LEGEND_POWER')."'"; ?>,
                  yAxis: 2,
                  color: <?php echo "'".$color_power."'"; ?>,
                  data: [
                    <?php if((isset($datap))&&(!empty($datap))) echo "$datap"; ?>
                  ]
               <?php } ?>

               <?php if((isset($data))&&(!empty($data))) { ?>
               }, {
                  name: <?php echo "'".$plugs_infos[$select_plug-1]["PLUG_NAME"]."'"; ?>,
                  color: <?php echo "'".$GLOBALS["LIST_GRAPHIC_COLOR_PROGRAM"][$select_plug-1]."'"; ?>,
                  data: [
                    <?php if((isset($data))&&(!empty($data))) echo "$data"; ?>
                  ]
               <?php } ?>
            }
         ]
        });
    });
    
});
</script>
<br /><br />

<div id="container" style="width: 800px; height: 400px; margin: 0 auto"></div>

<?php } ?>
<br />
