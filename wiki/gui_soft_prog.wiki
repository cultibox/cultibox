#summary Programmation des prises

= Sommaire =
<wiki:toc max_depth="3" />

= Introduction =
Chacune des prises possède un programme journalier. 
Pour configurer le programme d'une prise:
 * Connecter la carte SD sur l'ordinateur
 * Ouvrir le logiciel Cultibox
 * Cliquer sur l'onglet Programme
 * Sélectionner dans le menu déroulant le numéro de la prise que vous souhaitez modifier

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_menu_programm.png

La page des programmes vous permet de réaliser trois actions distinctes:
  * Visualiser le programmes des prises
  * Créer ou modifier le programme d'une prise
  * Gérer le programme des prises: importer ou exporter les programmes, remettre à zéro tous les programmes...


= Visualisation des programmes =
Dans la première partie de la page des programmes, un graphique s'affiche contenant le programme de la prise sélectionné. Un menu déroulant à côté du titre *Visualiser le comportement actuel de la prise* vous permet d'afficher un programme pour une prise particulière. Ce graphique vous offre plusieurs fonctionnalités pour rendre plus facile la visualisation ou la comparaison des programmes:

 * *Afficher ou cacher des programmes*: si vous voulez cacher ou faire apparaître les programmes des autres prises, il vous suffit de cliquer sur leur titre présent dans la légende à droite du graphique

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_program_hideshow.png

 * *Zoom temporel*: il est possible de zoomer sur une partie du programme afin de n'afficher qu'une partie du temps écoulé et mieux se rendre compte des variations pendant cette période. Pour cela sélectionnez simplement la zone qui vous intéresse et le graphique fera le reste. Une fois qu'un zoom est réalisé, un bouton apparaît en bas du graphique nommé *Annuler le zoom temporel*. Il vous suffira de cliquer dessus afin de revenir au format d'origine du graphique

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_program_zoomx.png

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_program_cancelx.png

 * *Export du graphique dans un fichier/Mode impression*: en haut à droite du graphique se trouve un menu vous permettant diverses actions. Une fois que vous avez cliqué sur ce menu, il vous est possible d'exporter votre graphique dans de nombreux format (PDF, JPEG ...). Il est aussi possible d'afficher le mode impression du graphique. Votre graphique sera alors affiché sans le reste de la page.

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_program_print.png


= Créer ou modifier un programme pour une prise =

== Programmation standard ==
Les deux états standards d'une prise sont: éteint ou allumé. Pour changer l'état d'une prise:
 * Sélectionnez une heure de départ: l'heure de départ doit être différente de l'heure de fin
 * Sélectionnez une heure de fin: l'heure de fin doit être différente de l'heure de départ
 * Sélectionnez l'état de la prise
 * Cliquer sur le bouton *Valider*

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_2.png


Quelques remarques sur la programmation des actions:

 * Si vous sélectionnez une heure de fin qui est avant l'heure de début, le programme appliquera l'état choisi de la façon suivante: de heure de début à minuit et de minuit à heure de fin. Cette fonction est pratique pour allumer une lampe de 20h à 4h.
 * Vous pouvez utiliser l'assistant de choix d'heure. En cliquant sur l'icône de l'horloge à côté des heures de début et de fin, un assistant s'ouvrira vous permettant de choisir facilement les heures voulues (les heures doivent être au format HH:MM:SS):

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_program_timehelper.png

 * La case à cocher nommée *Effacer l'ancien programme* vous permet d'appliquer votre nouveau programme comme si aucun programme n'était encore défini. L'ancien programme en cours est remplacé par le nouveau que vous venez de valider


== Programmation cyclique ==
La programmation cyclique permet de réaliser les mêmes actions que la programmation standard. L'intérêt de ce mode de programmation est de répéter une même action plusieurs fois.
L'action commence à l'heure de départ, dure le temps entre heure de fin et heure de départ et fini à minuit.
Pour appliquer une programmation cyclique
 * Choisissez le numéro de la prise à configurer dans le menu à côté du titre
 * Rentrez une heure de départ ou utilisez l'aide de sélection de l'heure expliquée dans la section précédente
 * Rentrez une heure de fin ou utilisez l'aide de sélection de l'heure expliquée dans la section précédente
 * Sélectionnez l'état de la prise
 * Sélectionnez le temps entre deux actions (champ *Répéter toutes les*)
 * Cliquez sur le bouton *Valider*

Le champ *Répéter toutes les* sert à calculer la période de répétition de l'action. L'interface ajoutera ce temps à l'heure de départ pour déterminer l'action suivante et ainsi de suite jusqu'à minuit.

Par exemple, les paramètres suivants:

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_3.png

Donne le programme suivant:

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_4.png

Astuce:
 *  Si vous avez besoin que l'action répétée se finisse avant minuit: Validez l'action répétée puis appliquez une programmation standard sur la période où vous ne désirez pas d'action répétée.

Remarques:
 * Le nombre de changement d'état des prises est limité à 255 pour une journée. Il est donc possible que toutes les actions créées par la programmation cyclique ne soit pas prise en compte. Dans ce cas, une petite fenêtre s'ouvre et vous informe.
 * La durée entre deux répétitions d'un programme cyclique est limitée à 5 minutes.

== Régulation ==
La régulation permet de changer l'état d'une prise en fonction d'une condition climatique.

Pour qu'une prise puisse être utilisée en régulation il faut qu'elle soit configurée. Pour ce faire:
 * Cliquez sur l'onglet *Prise* du menu principal  et sélectionnez le numéro de la prise à configurer dans la liste déroulante, ou alors, depuis la page des programmes, utilisez le bouton *Configurer la prise associée à ce programme* qui vous permet de passer directement à la configuration de la prise du programme sélectionné: (pour plus d'informations vous pouvez aussi vous reporter à la section [gui_soft_plugs Configuration des prises]):

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_program_jump_plug.png

 * Définir le type de prise :
   * Ventilateur: lorsque la prise est allumée, la température baisse
   * Chauffage: lorsque la prise est allumée, la température augmente
   * Humidificateur: lorsque la prise est allumée, l'humidité augmente
   * Déshumidificateur: lorsque la prise est allumée, l'humidité baisse
   * Les autres types (Lampe, inconnu) ne permettent pas de faire de régulation

Le type de la prise détermine le fonctionnement de la régulation. Par exemple, si vous choisissez *Chauffage*, la prise sera allumée lorsque la température sera inférieure à la consigne. SI vous choisissez *humidificateur*, la prise sera allumée lorsque l'humidité sera inférieure à la consigne. 

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_1.png

Pour plus d'informations, se reporter à la section [gui_soft_prog_regul Régulation]

== Combinaison ==
Il est tout à fait possible de combiner plusieurs actions dans la même journée. Par exemple:
 * La prise 2 allumée de 2h à 5h
 * En régulation à 22°C de 5h à 16h
 * En régulation à 28°C de 16h à 18h
 * Éteinte, le reste du temps

Il faut donc programmer trois actions. La première action est la suivante (N'oubliez pas de cliquer sur *Valider* entre chaque action):

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_6.png

La deuxième action:

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_1.png

Et la dernière action:

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_7.png

Ce qui donne le résultat suivant:

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_programmation_8.png

== Régulation secondaire ==
La régulation secondaire a un fonctionnement plus particulier. Pour vous familiariser avec son fonctionnement, reportez vous à la section [gui_soft_second_regul Régulation secondaire]


= Gestion des programmes =

La dernière section porte sur les fonctionnalités offertes quant à la gestion des vos programmes/prises. Dans l'onglet des programmes, tout en bas, vous avez accès à ces fonctionnalités:

http://cultibox.googlecode.com/svn/wiki/img/gui_soft_program_manage.png

Il est possible de:
 * [gui_soft_prog#Ajouter_ou_supprimer_une_prise Ajouter une prise]
 * [gui_soft_prog#Ajouter_ou_supprimer_une_prise Supprimer une prise]
 * [gui_soft_prog#Effacer_un_ou_tous_les_programmes Effacer un ou tous les programmes des prises]
 * [gui_soft_prog#Exporter_un_programme Exporter le programme]
 * [gui_soft_prog#Importer_un_programme Importer un programme]

== Ajouter ou supprimer une prise ==

Le nombre de prises de base est définie à trois, cependant la Cultibox peut gérer jusqu'à 10 prises. Pour ajouter ou supprimer une prise dans le logiciel, vous avez deux possibilités: soit vous rendre dans l'onglet *Configuration* du menu et configurer le nombre de prises ([gui_soft_conf Configuration]) ou alors cliquez sur les boutons *Ajouter une prise* ou *Supprimer une prise* pour réaliser cette opération directement. Il est à noter que vous ne pouvez pas descendre en dessous de 3 prises ni avoir plus de 10 prises.

== Effacer un ou tous les programmes ==

Pour remettre à zéro un programme, vous pouvez utiliser le *Ré-initialiser* qui remet à zéro le programme de la prise choisie. Il est aussi possible de ré-initialiser toutes les prises si vous choisissez *de toutes les prises* dans la liste déroulante.

== Exporter un programme ==

Vous pouvez exporter un programme dans un [gui_soft_prog#Fichier_Programme Fichier Programme] en cliquant sur le bouton *Exporter*. Ce fichier décrit les changements d'état de la prise courante. Pour plus d'information sur le format du fichier exporter voir le paragraphe [gui_soft_prog#Fichier_Programme Fichier Programme].

== Importer un programme ==

Vous pouvez importer un [gui_soft_prog#Fichier_Programme Fichier Programme] pour configurer une prise en sélectionnant le bouton *Importer*. Vous pouvez aussi configurer de cette façon plusieurs prises avec le même programme ou échanger des programmes avec d'autres utilisateur Cultibox.

== Fichier Programme ==

Le fichier utilisé pour réaliser  les importation/exportation de programme est un fichier au format CSV. Il porte l'extension .prg.
La première ligne de ce fichier contient le titre des colonnes :

{{{
#Program : time_start time_stop value
}}}

En dessous de ce titre, une ligne représente une action. Sur chaque ligne, on trouve dans l'ordre : l'heure de départ de l'action, l'heure de fin de l'action et l'état de la prise. L'état de la prise peut être:
 * 99.9 Si elle doit être allumée 
 * Tout autre valeur définit une valeur de régulation
Il n'est pas nécessaire de définir quand la prise doit être éteint. C4est l'état par défaut.

Par exemple :
{{{
080000,200000,99.9
210000,223000,18.5
}}}

Indique que la prise doit être allumée (99.9) de 08h00m00s à 20h00m00s puis que de 21h00m00s à 22h30m00s une régulation de 18.5 doit être appliquée.